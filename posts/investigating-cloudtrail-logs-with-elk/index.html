<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Investigating CloudTrail Logs using ELK Stack | logsec</title>
<meta name=keywords content>
<meta name=description content="AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.
You can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana.">
<meta name=author content>
<link rel=canonical href=https://harwinds.github.io/logsec/posts/investigating-cloudtrail-logs-with-elk/>
<link crossorigin=anonymous href=/logsec/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/logsec/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=16x16 href=https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E>
<link rel=icon type=image/png sizes=32x32 href=https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E>
<link rel=apple-touch-icon href=https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E>
<link rel=mask-icon href=https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.91.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Investigating CloudTrail Logs using ELK Stack">
<meta property="og:description" content="AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.
You can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://harwinds.github.io/logsec/posts/investigating-cloudtrail-logs-with-elk/"><meta property="og:image" content="https://harwinds.github.io/logsec/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-04-20T00:00:00+00:00">
<meta property="article:modified_time" content="2021-04-20T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://harwinds.github.io/logsec/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Investigating CloudTrail Logs using ELK Stack">
<meta name=twitter:description content="AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.
You can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://harwinds.github.io/logsec/posts/"},{"@type":"ListItem","position":3,"name":"Investigating CloudTrail Logs using ELK Stack","item":"https://harwinds.github.io/logsec/posts/investigating-cloudtrail-logs-with-elk/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Investigating CloudTrail Logs using ELK Stack","name":"Investigating CloudTrail Logs using ELK Stack","description":"AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.\nYou can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana.","keywords":[],"articleBody":"AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.\nYou can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana. Here are some of the KQL (Kibana Query Language) queries that you can use to search for some key CloudTrail events to monitor for Security in AWS.\nPlease note that I’m using the index pattern cloudwatch* for the CloudTrail logs.\n1. CloudTrail Logging Turned Off Identifies the deletion of an AWS log trail. An adversary may delete trails in an attempt to evade defenses.\nKQL Query:\n_index:cloudwatch* and eventName:(DeleteTrail or UpdateTrail or StopLogging)\rMITRE ATT\u0026CK Tactic: Defense Evasion\nMITRE ATT\u0026CK Techniques: T1562 - Impair Defenses\n2. Delete Attempts on CloudTrail S3 Buckets Identifies the deletion of an AWS S3 bucket containing the CloudTrai logs. You can update the requestParameters.bucketName as per the naming convention for the S3 buckets storing CloudTrail logs. An adversary may delete trails in an attempt to evade defenses.\nKQL Query:\n_index:cloudwatch* AND eventName:(DeleteBucket OR DeleteObject OR DeleteObjects) AND requestParameters.bucketName: *logs\rMITRE ATT\u0026CK Tactics: Impact\nMITRE ATT\u0026CK Techniques: T1485 - (Data Destruction)\n3. Creation of New IAM User Detects creation of new user, in the actual production environment, most probably you will be using federated sign-in through Active Directory (AD) and Active Directory Federation Services (ADFS), instead of local IAM users. With the help of this search, you can easily search if someone creates a new local user.\nKQL Query:\n_index:cloudwatch* AND eventName:CreateUser AND eventSource:iam.amazonaws.com\rMITRE ATT\u0026CK Tactics: Persistence\nMITRE ATT\u0026CK Techniques: T1136 - Create Account\n4. Cross Account VPC Peering Connections A VPC peering connection is a networking connection between two VPCs that enables you to route traffic between them using private IPv4 addresses or IPv6 addresses. Instances in either VPC can communicate with each other as if they are within the same network. You can create a VPC peering connection between your own VPCs, or with a VPC in another AWS account. The VPCs can be in different regions (also known as an inter-region VPC peering connection).\nThis can produce false positives for cases where VPC peering is created for legitimate purposes, but you can look for events where connection is made between VPC outside of organization.\nKQL Query:\n_index:cloudwatch* and eventSource:\"ec2.amazonaws.com\" and eventName:\"CreateVpcPeeringConnection\"\rMITRE ATT\u0026CK Tactics: Initial Access\nMITRE ATT\u0026CK Techniques: T1199\n5. AWS IAM Backdoor Users Keys Detects AWS API key creation for a user by another user. Backdoored users can be used to obtain persistence in the AWS environment. Also with this alert, you can detect a flow of AWS keys in your org.\nKQL Query:\n((eventSource:\"iam.amazonaws.com\" AND eventName:\"CreateAccessKey\") AND (NOT (userIdentity.arn.keyword:*responseElements.accessKey.userName*)))\rMITRE ATT\u0026CK Tactics: Persistence\nMITRE ATT\u0026CK Techniques: T1098\nSub-Technique: T1098.001 Additional Cloud Credentials\n6. AWS EC2 Startup Shell Script Change Detects changes to the EC2 instance startup script. The shell script will be executed as root/SYSTEM everytime the specific instances are booted up.\nKQL Query:\n(eventSource:\"ec2.amazonaws.com\" AND requestParameters.userData.keyword:* AND eventName:\"ModifyInstanceAttribute\")\r7. AWS - Retrieve Secret on Secrets Manager Detected This rule is identifies when users attempt to access the secrets in AWS Secrets Manager to steal certificates, credentials, or other sensitive material.\nKQL Query:\n(eventSource:\"secretsmanager.amazonaws.com\" AND eventName:\"GetSecretValue\")\rMITRE ATT\u0026CK Tactics: Credential Access\nMITRE ATT\u0026CK Techniques: T1528\n ","wordCount":"583","inLanguage":"en","datePublished":"2021-04-20T00:00:00Z","dateModified":"2021-04-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://harwinds.github.io/logsec/posts/investigating-cloudtrail-logs-with-elk/"},"publisher":{"@type":"Organization","name":"logsec","logo":{"@type":"ImageObject","url":"https://harwinds.github.io/logsec/%3Clink%20/%20abs%20url%3E"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://harwinds.github.io/logsec accesskey=h title="logsec (Alt + H)">logsec</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://harwinds.github.io/logsec/pages/about title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://harwinds.github.io/logsec/posts/ title=posts>
<span>posts</span>
</a>
</li>
<li>
<a href=https://harwinds.github.io/logsec/search/ title=search>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://harwinds.github.io/logsec>Home</a>&nbsp;»&nbsp;<a href=https://harwinds.github.io/logsec/posts/>Posts</a></div>
<h1 class=post-title>
Investigating CloudTrail Logs using ELK Stack
</h1>
<div class=post-meta><span title="2021-04-20 00:00:00 +0000 UTC">April 20, 2021</span>&nbsp;·&nbsp;3 min
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#1-cloudtrail-logging-turned-off aria-label="1. CloudTrail Logging Turned Off">1. CloudTrail Logging Turned Off</a></li>
<li>
<a href=#2-delete-attempts-on-cloudtrail-s3-buckets aria-label="2. Delete Attempts on CloudTrail S3 Buckets">2. Delete Attempts on CloudTrail S3 Buckets</a></li>
<li>
<a href=#3-creation-of-new-iam-user aria-label="3. Creation of New IAM User">3. Creation of New IAM User</a></li>
<li>
<a href=#4-cross-account-vpc-peering-connections aria-label="4. Cross Account VPC Peering Connections">4. Cross Account VPC Peering Connections</a></li>
<li>
<a href=#5-aws-iam-backdoor-users-keys aria-label="5. AWS IAM Backdoor Users Keys">5. AWS IAM Backdoor Users Keys</a></li>
<li>
<a href=#6-aws-ec2-startup-shell-script-change aria-label="6. AWS EC2 Startup Shell Script Change">6. AWS EC2 Startup Shell Script Change</a></li>
<li>
<a href=#7-aws---retrieve-secret-on-secrets-manager-detected aria-label="7. AWS - Retrieve Secret on Secrets Manager Detected">7. AWS - Retrieve Secret on Secrets Manager Detected</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>AWS CloudTrail is an AWS service that helps you enable governance, compliance, and operational and risk auditing of your AWS account. Actions taken by a user, role, or an AWS service are recorded as events in CloudTrail. Events include actions taken in the AWS Management Console, AWS Command Line Interface, and AWS SDKs and APIs.</p>
<p>You can ship these CloudTrail logs into the ELK stack and learn how to visualize these events, near real time, using Kibana. Here are some of the <a href=https://www.elastic.co/guide/en/kibana/current/kuery-query.html>KQL</a> (Kibana Query Language) queries that you can use to search for some key CloudTrail events to monitor for Security in AWS.</p>
<p>Please note that I&rsquo;m using the <a href=https://www.elastic.co/guide/en/kibana/current/index-patterns.html>index pattern</a> <code>cloudwatch*</code> for the CloudTrail logs.</p>
<h2 id=1-cloudtrail-logging-turned-off>1. CloudTrail Logging Turned Off<a hidden class=anchor aria-hidden=true href=#1-cloudtrail-logging-turned-off>#</a></h2>
<p>Identifies the deletion of an AWS log trail. An adversary may delete trails in an attempt to evade defenses.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>_index:cloudwatch* and eventName:(DeleteTrail or UpdateTrail or StopLogging)
</code></pre><p><strong>MITRE ATT&CK Tactic:</strong> Defense Evasion<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1562/001/>T1562</a> - Impair Defenses</p>
<h2 id=2-delete-attempts-on-cloudtrail-s3-buckets>2. Delete Attempts on CloudTrail S3 Buckets<a hidden class=anchor aria-hidden=true href=#2-delete-attempts-on-cloudtrail-s3-buckets>#</a></h2>
<p>Identifies the deletion of an AWS S3 bucket containing the CloudTrai logs. You can update the <code>requestParameters.bucketName</code> as per the naming convention for the S3 buckets storing CloudTrail logs. An adversary may delete trails in an attempt to evade defenses.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>_index:cloudwatch* AND eventName:(DeleteBucket OR DeleteObject OR DeleteObjects) AND requestParameters.bucketName: *logs
</code></pre><p><strong>MITRE ATT&CK Tactics:</strong> Impact<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1485/>T1485</a> - (Data Destruction)</p>
<h2 id=3-creation-of-new-iam-user>3. Creation of New IAM User<a hidden class=anchor aria-hidden=true href=#3-creation-of-new-iam-user>#</a></h2>
<p>Detects creation of new user, in the actual production environment, most probably you will be using federated sign-in through Active Directory (AD) and Active Directory Federation Services (ADFS), instead of local IAM users. With the help of this search, you can easily search if someone creates a new local user.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>_index:cloudwatch* AND eventName:CreateUser AND eventSource:iam.amazonaws.com
</code></pre><p><strong>MITRE ATT&CK Tactics:</strong> Persistence<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1136/>T1136</a> - Create Account</p>
<h2 id=4-cross-account-vpc-peering-connections>4. Cross Account VPC Peering Connections<a hidden class=anchor aria-hidden=true href=#4-cross-account-vpc-peering-connections>#</a></h2>
<p>A <a href=https://docs.aws.amazon.com/vpc/latest/peering/what-is-vpc-peering.html>VPC peering</a> connection is a networking connection between two VPCs that enables you to route traffic between them using private IPv4 addresses or IPv6 addresses. Instances in either VPC can communicate with each other as if they are within the same network. You can create a VPC peering connection between your own VPCs, or with a VPC in another AWS account. The VPCs can be in different regions (also known as an inter-region VPC peering connection).</p>
<p>This can produce false positives for cases where VPC peering is created for legitimate purposes, but you can look for events where connection is made between VPC outside of organization.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>_index:cloudwatch* and eventSource:&quot;ec2.amazonaws.com&quot; and eventName:&quot;CreateVpcPeeringConnection&quot;
</code></pre><p><strong>MITRE ATT&CK Tactics:</strong> Initial Access<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1199/>T1199</a></p>
<h2 id=5-aws-iam-backdoor-users-keys>5. AWS IAM Backdoor Users Keys<a hidden class=anchor aria-hidden=true href=#5-aws-iam-backdoor-users-keys>#</a></h2>
<p>Detects AWS API key creation for a user by another user. Backdoored users can be used to obtain persistence in the AWS environment. Also with this alert, you can detect a flow of AWS keys in your org.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>((eventSource:&quot;iam.amazonaws.com&quot; AND eventName:&quot;CreateAccessKey&quot;) AND (NOT (userIdentity.arn.keyword:*responseElements.accessKey.userName*)))
</code></pre><p><strong>MITRE ATT&CK Tactics:</strong> Persistence<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1098/>T1098</a><br>
<strong>Sub-Technique:</strong> T1098.001 Additional Cloud Credentials</p>
<h2 id=6-aws-ec2-startup-shell-script-change>6. AWS EC2 Startup Shell Script Change<a hidden class=anchor aria-hidden=true href=#6-aws-ec2-startup-shell-script-change>#</a></h2>
<p>Detects changes to the EC2 instance startup script. The shell script will be executed as root/SYSTEM everytime the specific instances are booted up.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>(eventSource:&quot;ec2.amazonaws.com&quot; AND requestParameters.userData.keyword:* AND eventName:&quot;ModifyInstanceAttribute&quot;)
</code></pre><h2 id=7-aws---retrieve-secret-on-secrets-manager-detected>7. AWS - Retrieve Secret on Secrets Manager Detected<a hidden class=anchor aria-hidden=true href=#7-aws---retrieve-secret-on-secrets-manager-detected>#</a></h2>
<p>This rule is identifies when users attempt to access the secrets in AWS Secrets Manager to steal certificates, credentials, or other sensitive material.</p>
<p>KQL Query:</p>
<pre tabindex=0><code>(eventSource:&quot;secretsmanager.amazonaws.com&quot; AND eventName:&quot;GetSecretValue&quot;)
</code></pre><p><strong>MITRE ATT&CK Tactics:</strong> Credential Access<br>
<strong>MITRE ATT&CK Techniques:</strong> <a href=https://attack.mitre.org/techniques/T1528/>T1528</a></p>
<hr>
</div>
<footer class=post-footer>
<nav class=paginav>
<a class=prev href=https://harwinds.github.io/logsec/posts/git-workflow-automation/>
<span class=title>« Prev Page</span>
<br>
<span>GitHub Workflow Automation Script</span>
</a>
<a class=next href=https://harwinds.github.io/logsec/posts/splunk-range-setup/>
<span class=title>Next Page »</span>
<br>
<span>Splunk Attack Range on AWS - Guide</span>
</a>
</nav>
</footer><script src=https://giscus.app/client.js data-repo=harwinds/logsec data-repo-id="MDEwOlJlcG9zaXRvcnkzNDI0NDI5MjQ=" data-category=General data-category-id=DIC_kwDOFGlDrM4B-2FE data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-theme=dark_dimmed data-lang=en crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://harwinds.github.io/logsec>logsec</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>