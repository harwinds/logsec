<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ingest AWS CloudTrail logs to Splunk | logsec</title><meta name=keywords content><meta name=description content="This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.
There are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation."><meta name=author content><link rel=canonical href=https://www.logsec.cloud/posts/ingest-cloudtrail-logs-to-splunk/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Ingest AWS CloudTrail logs to Splunk"><meta property="og:description" content="This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.
There are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation."><meta property="og:type" content="article"><meta property="og:url" content="https://www.logsec.cloud/posts/ingest-cloudtrail-logs-to-splunk/"><meta property="og:image" content="https://www.logsec.cloud/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-20T00:00:00+00:00"><meta property="article:modified_time" content="2020-04-20T00:00:00+00:00"><meta property="og:site_name" content="logsec"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.logsec.cloud/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Ingest AWS CloudTrail logs to Splunk"><meta name=twitter:description content="This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.
There are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.logsec.cloud/posts/"},{"@type":"ListItem","position":3,"name":"Ingest AWS CloudTrail logs to Splunk","item":"https://www.logsec.cloud/posts/ingest-cloudtrail-logs-to-splunk/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ingest AWS CloudTrail logs to Splunk","name":"Ingest AWS CloudTrail logs to Splunk","description":"This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.\nThere are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation.","keywords":[],"articleBody":"This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.\nThere are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation. For our demo purposes, we will be using Terraform by Hashicorp. Terraform is a tool for building, changing, and versioning infrastrcuture safely and efficiently.\nThis article assumes you have some familiarity with Terraform already.\nAll Terraform files are available to download at my GitHub Repo. You just need to edit the terraform.tfvars file and put your AWS ACCESS KEY ID and SECRET ACCESS KEY.\nmaven@pluto:~$ tree ./terraform/ ./terraform/ ├── cloudtrail.tf ├── module.tf ├── output.tf ├── provider.tf ├── splunk │ ├── instance_splunk.tf │ ├── splunk_iam_role.tf │ ├── splunk_iam_role_pol.json │ ├── user_data_splunk.sh │ ├── variables.tf │ └── vpc_splunk.tf ├── sqs_cloudtrail_logs.tf ├── terraform.tfvars ├── variables.tf └── versions.tf 1.\tCreate an IAM Role for the Splunk Instance and attach a policy which allows EC2 instances to call AWS services on your behalf. resource \"aws_iam_role\" \"splunk_iam_role\" { name = \"splunk_role\" assume_role_policy = \u003c","wordCount":"1613","inLanguage":"en","datePublished":"2020-04-20T00:00:00Z","dateModified":"2020-04-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.logsec.cloud/posts/ingest-cloudtrail-logs-to-splunk/"},"publisher":{"@type":"Organization","name":"logsec","logo":{"@type":"ImageObject","url":"https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.logsec.cloud accesskey=h title="logsec (Alt + H)">logsec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.logsec.cloud/ title=posts><span>posts</span></a></li><li><a href=https://www.logsec.cloud/pages/about title=about><span>about</span></a></li><li><a href=https://www.logsec.cloud/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.logsec.cloud>Home</a>&nbsp;»&nbsp;<a href=https://www.logsec.cloud/posts/>Posts</a></div><h1 class=post-title>Ingest AWS CloudTrail logs to Splunk</h1><div class=post-meta><span title='2020-04-20 00:00:00 +0000 UTC'>April 20, 2020</span>&nbsp;·&nbsp;8 min</div></header><div class=post-content><p>This blog post will walk you through setting up a Splunk environment on AWS for lab purposes using Splunk Enterprise Free 60-day trail. After 60 days you can convert to a perpetual free license or purchase a Splunk Enterprise license to continue using the expanded functionality designed for enterprise-scale deployments. There is an indexing limit of 500 MB/Day which will be more than enough for our demo purposes.</p><p><img loading=lazy src=/images/2020_04_20_0.png alt></p><p>There are multiple ways to accomplish this - using AWS Console, CLI or using CloudFormation. For our demo purposes, we will be using <a href=https://www.terraform.io/>Terraform by Hashicorp</a>. Terraform is a tool for building, changing, and versioning infrastrcuture safely and efficiently.</p><p>This article assumes you have some familiarity with Terraform already.</p><p>All Terraform files are available to download at my <a href=https://github.com/harwinds/logsec_blog_code>GitHub Repo</a>. You just need to edit the <code>terraform.tfvars</code> file and put your AWS <code>ACCESS KEY ID</code> and <code>SECRET ACCESS KEY</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>maven@pluto:~$ tree ./terraform/
</span></span><span style=display:flex><span>./terraform/
</span></span><span style=display:flex><span>├── cloudtrail.tf
</span></span><span style=display:flex><span>├── module.tf
</span></span><span style=display:flex><span>├── output.tf
</span></span><span style=display:flex><span>├── provider.tf
</span></span><span style=display:flex><span>├── splunk
</span></span><span style=display:flex><span>│   ├── instance_splunk.tf
</span></span><span style=display:flex><span>│   ├── splunk_iam_role.tf
</span></span><span style=display:flex><span>│   ├── splunk_iam_role_pol.json
</span></span><span style=display:flex><span>│   ├── user_data_splunk.sh
</span></span><span style=display:flex><span>│   ├── variables.tf
</span></span><span style=display:flex><span>│   └── vpc_splunk.tf
</span></span><span style=display:flex><span>├── sqs_cloudtrail_logs.tf
</span></span><span style=display:flex><span>├── terraform.tfvars
</span></span><span style=display:flex><span>├── variables.tf
</span></span><span style=display:flex><span>└── versions.tf
</span></span></code></pre></div><h3 id=1create-an-iam-role-for-the-splunk-instance-and-attach-a-policy-which-allows-ec2-instances-to-call-aws-services-on-your-behalf>1. Create an IAM Role for the Splunk Instance and attach a policy which allows EC2 instances to call AWS services on your behalf.<a hidden class=anchor aria-hidden=true href=#1create-an-iam-role-for-the-splunk-instance-and-attach-a-policy-which-allows-ec2-instances-to-call-aws-services-on-your-behalf>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role&#34;</span> <span style=color:#e6db74>&#34;splunk_iam_role&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;splunk_role&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>assume_role_policy</span> = <span style=color:#f92672>&lt;&lt;EOF</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Statement&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Action&#34;: &#34;sts:AssumeRole&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Principal&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;Service&#34;: &#34;ec2.amazonaws.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Sid&#34;: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#f92672>EOF</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_iam_role_arn&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ARN of the Role&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>splunk_iam_role</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-create-an-iam-policy-and-attach-to-the-splunk-iam-role-with-all-the-required-permissions-to-pull-logs-from-required-aws-services>2. Create an IAM Policy and attach to the Splunk IAM Role with all the required permissions to pull logs from required AWS services.<a hidden class=anchor aria-hidden=true href=#2-create-an-iam-policy-and-attach-to-the-splunk-iam-role-with-all-the-required-permissions-to-pull-logs-from-required-aws-services>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_role_policy&#34;</span> <span style=color:#e6db74>&#34;splunk_iam_policy&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;splunk_policy&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span> = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>splunk_iam_role</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>policy</span> = file(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span>.module<span style=color:#e6db74>}</span><span style=color:#e6db74>/splunk_iam_role_pol.json&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Example IAM policy which will cover the majority of access splunk should need within AWS. Policy containing permisisons for all inputs is available at <a href=https://docs.splunk.com/Documentation/AddOns/released/AWS/ConfigureAWSpermissions>Splunk Docs</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Version&#34;</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Statement&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Effect&#34;</span>: <span style=color:#e6db74>&#34;Allow&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Action&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:GetQueueAttributes&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:ListQueues&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:ReceiveMessage&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:GetQueueUrl&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:SendMessage&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sqs:DeleteMessage&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:ListBucket&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetObject&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketLocation&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:ListAllMyBuckets&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketTagging&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetAccelerateConfiguration&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketLogging&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetLifecycleConfiguration&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;s3:GetBucketCORS&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config:DeliverConfigSnapshot&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config:DescribeConfigRules&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config:DescribeConfigRuleEvaluationStatus&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config:GetComplianceDetailsByConfigRule&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;config:GetComplianceSummaryByConfigRule&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;iam:GetUser&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;iam:ListUsers&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;iam:GetAccountPasswordPolicy&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;iam:ListAccessKeys&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;iam:GetAccessKeyLastUsed&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;autoscaling:Describe*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cloudwatch:Describe*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cloudwatch:Get*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cloudwatch:List*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sns:Get*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sns:List*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sns:Publish&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:DescribeLogGroups&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:DescribeLogStreams&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;logs:GetLogEvents&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeInstances&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeReservedInstances&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeSnapshots&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeRegions&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeKeyPairs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeNetworkAcls&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeSecurityGroups&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeSubnets&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeVolumes&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeVpcs&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeImages&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;ec2:DescribeAddresses&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;lambda:ListFunctions&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;rds:DescribeDBInstances&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;cloudfront:ListDistributions&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeLoadBalancers&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeInstanceHealth&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeTags&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeTargetGroups&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeTargetHealth&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;elasticloadbalancing:DescribeListeners&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;inspector:Describe*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;inspector:List*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kinesis:Get*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kinesis:DescribeStream&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kinesis:ListStreams&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kms:Decrypt&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;sts:AssumeRole&#34;</span>
</span></span><span style=display:flex><span>      ],
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Resource&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-create-an-iam-instance-profile-for-splunk-instance>3. Create an IAM instance profile for Splunk Instance.<a hidden class=anchor aria-hidden=true href=#3-create-an-iam-instance-profile-for-splunk-instance>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_iam_instance_profile&#34;</span> <span style=color:#e6db74>&#34;splunk_instance_profile&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;splunk_instance_profile&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>role</span> = <span style=color:#a6e22e>aws_iam_role</span>.<span style=color:#a6e22e>splunk_iam_role</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_instance_profile_name&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The instance profile&#39;s name&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_iam_instance_profile</span>.<span style=color:#a6e22e>splunk_instance_profile</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-create-a-cloudtrail-for-your-aws-account>4. Create a CloudTrail for your AWS Account.<a hidden class=anchor aria-hidden=true href=#4-create-a-cloudtrail-for-your-aws-account>#</a></h3><p>You can create up to five trails for each region. After you create a trail, CloudTrail automatically starts logging API calls and related events in your account to the Amazon S3 bucket that you specify. To stop logging, you can turn off logging for the trail or delete it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_cloudtrail&#34;</span> <span style=color:#e6db74>&#34;lab_trail&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                          = <span style=color:#e6db74>&#34;lab_trail&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>s3_bucket_name</span>                = <span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>trail_bucket</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>include_global_service_events</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>is_multi_region_trail</span>         = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;lab_trail_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The name of the trail&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_cloudtrail</span>.<span style=color:#a6e22e>lab_trail</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;lab_trail_region&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The region in which the trail was created&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_cloudtrail</span>.<span style=color:#a6e22e>lab_trail</span>.<span style=color:#a6e22e>home_region</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=5-create-an-amazon-s3-bucket-for-our-cloudtrail>5. Create an Amazon S3 bucket for our CloudTrail.<a hidden class=anchor aria-hidden=true href=#5-create-an-amazon-s3-bucket-for-our-cloudtrail>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_s3_bucket&#34;</span> <span style=color:#e6db74>&#34;trail_bucket&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bucket</span>        = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>data.<span style=color:#a6e22e>aws_caller_identity</span>.<span style=color:#a6e22e>current</span>.<span style=color:#a6e22e>account_id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-lab-cloudtrail-logs&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>force_destroy</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>policy</span> = <span style=color:#f92672>&lt;&lt;POLICY</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;Statement&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Sid&#34;: &#34;AWSbucketAclCheck&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Principal&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              &#34;Service&#34;: &#34;cloudtrail.amazonaws.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Action&#34;: &#34;s3:GetBucketAcl&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Resource&#34;: &#34;arn:aws:s3:::${data.aws_caller_identity.current.account_id}-lab-cloudtrail-logs&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Sid&#34;: &#34;AWSbucketWrite&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Principal&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              &#34;Service&#34;: &#34;cloudtrail.amazonaws.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            },
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Action&#34;: &#34;s3:PutObject&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Resource&#34;: &#34;arn:aws:s3:::${data.aws_caller_identity.current.account_id}-lab-cloudtrail-logs/AWSLogs/${data.aws_caller_identity.current.account_id}/*&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            &#34;Condition&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;StringEquals&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    &#34;s3:x-amz-acl&#34;: &#34;bucket-owner-full-control&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#f92672>POLICY</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;trail_bucket_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The name of the bucket&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>trail_bucket</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;trail_bucket_region&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ARN of the bucket&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>trail_bucket</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=6-create-two-sqs-queues>6. Create two SQS Queues.<a hidden class=anchor aria-hidden=true href=#6-create-two-sqs-queues>#</a></h3><p>Now it&rsquo;s time to create the SQS queues. Two queues will be required. One queue will be the dead letter queue for error messages to be kicked over to and the other will be the queue used to capture the S3 notifications when a new Cloud trail event is sent to the S3 bucket we created in earlier step.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># Add Amazon S3 Event Notification configuration to SQS Queue
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_sqs_queue&#34;</span> <span style=color:#e6db74>&#34;queue&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                       = <span style=color:#e6db74>&#34;s3_event_notification_queue&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>visibility_timeout_seconds</span> = <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>redrive_policy</span> = jsonencode({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>deadLetterTargetArn</span> = <span style=color:#a6e22e>aws_sqs_queue</span>.<span style=color:#a6e22e>dl_queue</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxReceiveCount</span>     = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>policy</span> = <span style=color:#f92672>&lt;&lt;POLICY</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Version&#34;: &#34;2012-10-17&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;Statement&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Effect&#34;: &#34;Allow&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Principal&#34;: &#34;*&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Action&#34;: &#34;sqs:SendMessage&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Resource&#34;: &#34;arn:aws:sqs:*:*:s3_event_notification_queue&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &#34;Condition&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &#34;ArnEquals&#34;: { &#34;aws:SourceArn&#34;: &#34;${aws_s3_bucket.trail_bucket.arn}&#34; }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    }
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  ]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#f92672>POLICY</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Set up a dead-letter queue for the SQS queue to be used for the input for storing invalid messages
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_sqs_queue&#34;</span> <span style=color:#e6db74>&#34;dl_queue&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;dl_queue_error_messages&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_s3_bucket_notification&#34;</span> <span style=color:#e6db74>&#34;bucket_notification&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>bucket</span> = <span style=color:#a6e22e>aws_s3_bucket</span>.<span style=color:#a6e22e>trail_bucket</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>queue</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>queue_arn</span> = <span style=color:#a6e22e>aws_sqs_queue</span>.<span style=color:#a6e22e>queue</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>events</span>    = [<span style=color:#e6db74>&#34;s3:ObjectCreated:*&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;sqs_arn&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ARN of the SQS queue&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_sqs_queue</span>.<span style=color:#a6e22e>queue</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=7-create-an-amazon-vpc-for-our-splunk-splunk-instance>7. Create an Amazon VPC for our Splunk Splunk Instance<a hidden class=anchor aria-hidden=true href=#7-create-an-amazon-vpc-for-our-splunk-splunk-instance>#</a></h3><p>Please note this step is not mandatory, you can use the default VPC as well. In this step we will demonstate how to setup our
own VPC, a public subnet, an Internet Gateway along with a route table.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#75715e># VPC
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_vpc&#34;</span> <span style=color:#e6db74>&#34;splunk_vpc&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;192.168.0.0/24&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>enable_dns_hostnames</span> = <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_tenancy</span> = <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk_vpc&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_vpc_arn&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ARN of the VPC&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>arn</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_vpc_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ID of the VPC&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Public Subnet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_subnet&#34;</span> <span style=color:#e6db74>&#34;splunk_subnet_public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>                  = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cidr_block</span>              = <span style=color:#e6db74>&#34;192.168.0.0/24&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>map_public_ip_on_launch</span> = <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>availability_zone</span>    = <span style=color:#e6db74>&#34;us-east-1a&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk_subnet_public&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_subnet_public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ID of the public subnet&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>splunk_subnet_public</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Internet GW
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_internet_gateway&#34;</span> <span style=color:#e6db74>&#34;splunk_gw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk_gw&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_gw&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ID of the IGW&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>splunk_gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Route Table
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table&#34;</span> <span style=color:#e6db74>&#34;splunk_route_table&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span> = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_block</span> = <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>gateway_id</span> = <span style=color:#a6e22e>aws_internet_gateway</span>.<span style=color:#a6e22e>splunk_gw</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk_route_table&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_route_table&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ID of the routing table&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>splunk_route_table</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Associate Route Table and Subnet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_route_table_association&#34;</span> <span style=color:#e6db74>&#34;splunk_route_table_subnet_public&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>      = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>splunk_subnet_public</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>route_table_id</span> = <span style=color:#a6e22e>aws_route_table</span>.<span style=color:#a6e22e>splunk_route_table</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=8-create-an-ec2-instance-of-the-latest-ubuntu-1804-on-a-t2medium-node>8. Create an EC2 Instance of the latest Ubuntu 18.04 on a t2.medium node.<a hidden class=anchor aria-hidden=true href=#8-create-an-ec2-instance-of-the-latest-ubuntu-1804-on-a-t2medium-node>#</a></h3><p>Now, let&rsquo;s create an instance where we will use the <code>user_data</code> argument to pass our bash script which will download
and install Splunk Enterprise for us.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;aws_ami&#34;</span> <span style=color:#e6db74>&#34;ubuntu_server&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>most_recent</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>owners</span> = [<span style=color:#e6db74>&#34;099720109477&#34;</span>]<span style=color:#75715e> # Canonical
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;name&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>values</span> = [<span style=color:#e6db74>&#34;ubuntu/images/hvm-ssd/ubuntu-bionic-18.04-amd64-server-*&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filter</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> = <span style=color:#e6db74>&#34;virtualization-type&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>values</span> = [<span style=color:#e6db74>&#34;hvm&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;splunk_instance&#34;</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>ami</span> = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>ubuntu_server</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>iam_instance_profile</span> = <span style=color:#a6e22e>aws_iam_instance_profile</span>.<span style=color:#a6e22e>splunk_instance_profile</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>instance_type</span> = <span style=color:#e6db74>&#34;t2.medium&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>key_name</span> = <span style=color:#e6db74>&#34;lab_kp&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>   # VPC
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>subnet_id</span> = <span style=color:#a6e22e>aws_subnet</span>.<span style=color:#a6e22e>splunk_subnet_public</span>.<span style=color:#a6e22e>id</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>   # SG
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>vpc_security_group_ids</span> = [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>splunk_sg</span>.<span style=color:#a6e22e>id</span>]
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>root_block_device</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>volume_type</span> = <span style=color:#e6db74>&#34;gp2&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>volume_size</span> = <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>user_data</span> = file(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>path</span>.module<span style=color:#e6db74>}</span><span style=color:#e6db74>/user_data_splunk.sh&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk&#34;</span>
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef> output</span> <span style=color:#e6db74>&#34;splunk_instance_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Instance ID&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_instance</span>.<span style=color:#a6e22e>splunk_instance</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef> output</span> <span style=color:#e6db74>&#34;splunk_instance_public_ip&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Public IP&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_instance</span>.<span style=color:#a6e22e>splunk_instance</span>.<span style=color:#a6e22e>public_ip</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef> output</span> <span style=color:#e6db74>&#34;splunk_instance_private_ip&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Private IP&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_instance</span>.<span style=color:#a6e22e>splunk_instance</span>.<span style=color:#a6e22e>private_ip</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># SG
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;splunk_sg&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Allow SSH inbound traffic&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#a6e22e>aws_vpc</span>.<span style=color:#a6e22e>splunk_vpc</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Splunk Port 8000 from Home Netowrk&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>home_ip</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/32&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ingress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;SSH from Home Netowrk&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>22</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>home_ip</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/32&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;splunk_sg&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;splunk_sg&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;The ID of the security group&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>       = <span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>splunk_sg</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>User Data</strong>: When you install Splunk Enterprise, you must create a username and password for your administrator account. We will create admin credentials using the <code>--gen-and-print-passwd</code> CLI arguments.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#! /bin/bash -xe
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>exec &gt; &gt;<span style=color:#f92672>(</span>tee /var/log/user-data.log|logger -t user-data -s 2&gt;/dev/console<span style=color:#f92672>)</span> 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>echo BEGIN
</span></span><span style=display:flex><span>sudo apt-get update
</span></span><span style=display:flex><span>sudo apt-get upgrade -y
</span></span><span style=display:flex><span>cd /tmp <span style=color:#f92672>&amp;&amp;</span> wget -O splunk-8.0.3-a6754d8441bf-linux-2.6-amd64.deb  
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;https://www.splunk.com/bin/splunk/DownloadActivityServlet?architecture=x86_64&amp;platform=linux&amp;version=8.0.3&amp;product=splunk&amp;filename=splunk-8.0.3-a6754d8441bf-linux-2.6-amd64.deb&amp;wget=true&#39;</span>
</span></span><span style=display:flex><span>cd /opt
</span></span><span style=display:flex><span>sudo dpkg -i /tmp/splunk-8.0.3-a6754d8441bf-linux-2.6-amd64.deb
</span></span><span style=display:flex><span>cd splunk/
</span></span><span style=display:flex><span>/opt/splunk/bin/splunk start --accept-license --answer-yes --no-prompt --gen-and-print-passwd
</span></span><span style=display:flex><span>echo END
</span></span></code></pre></div><h3 id=9-login-to-splunk-instance-using-the-public-ip-of-the-ec2-instance>9. Login to Splunk Instance using the public IP of the EC2 instance<a hidden class=anchor aria-hidden=true href=#9-login-to-splunk-instance-using-the-public-ip-of-the-ec2-instance>#</a></h3><p>Browse to <code>http://public_ip:8000</code></p><p><strong>username</strong>: admin<br><strong>password</strong>: You need to grab from the file /var/log/user-data.log</p><p>It will be randomly generated as we used the option <code>--gen-and-print-passwd</code></p><h3 id=10-install-these-two-apps-on-the-splunk-instance>10. Install these two apps on the Splunk Instance.<a hidden class=anchor aria-hidden=true href=#10-install-these-two-apps-on-the-splunk-instance>#</a></h3><ul><li><a href=https://splunkbase.splunk.com/app/1876/>Splunk Add-on for Amazon Web Services</a></li><li><a href=https://splunkbase.splunk.com/app/1274/>Splunk App for AWS</a></li></ul><p>Once the apps are installed, restart Splunk.</p><h3 id=11-go-to-app-splunk-add-on-for-aws-and-go-under-the-configuration-tab-youll-see-role-assigned-to-the-splunk-instance-will-populate-in-a-couple-of-seconds>11. Go to App: Splunk Add-on for AWS and go under the &ldquo;Configuration&rdquo; tab, you&rsquo;ll see Role Assigned to the Splunk instance will populate in a couple of seconds.<a hidden class=anchor aria-hidden=true href=#11-go-to-app-splunk-add-on-for-aws-and-go-under-the-configuration-tab-youll-see-role-assigned-to-the-splunk-instance-will-populate-in-a-couple-of-seconds>#</a></h3><p><img loading=lazy src=/images/2020_04_20_1.png alt></p><h3 id=12-go-to-inputs-tab>12. Go to &ldquo;Inputs&rdquo; tab<a hidden class=anchor aria-hidden=true href=#12-go-to-inputs-tab>#</a></h3><p>Create a New Input selectng Data Type <strong>CloudTrail</strong> and Input Type <strong>SQS-Based S3</strong></p><p><img loading=lazy src=/images/2020_04_20_2.png alt></p><h3 id=13-fill-out-the-aws-input-configuration-details>13. Fill out the AWS Input Configuration details<a hidden class=anchor aria-hidden=true href=#13-fill-out-the-aws-input-configuration-details>#</a></h3><ul><li>Please note under the <strong>AWS Account</strong>, name of the role assigned to the Instance will automatically show up.</li><li>For the <strong>SQS Queue Name</strong>, you will see two SQS queues we created in earlier post. Please select the Event Notification Queue.</li><li>For the <strong>Index</strong>, either you can create a new index for CloudTrail logs or using existing one.</li></ul><p><img loading=lazy src=/images/2020_04_20_3.pn alt></p><h3 id=14-go-to-search--reporting-app>14. Go to <code>Search & Reporting</code> App<a hidden class=anchor aria-hidden=true href=#14-go-to-search--reporting-app>#</a></h3><p>Search for the CloudTrail logs using the SPL:</p><pre tabindex=0><code>index=main sourcetype=&#34;aws:cloudtrail&#34;
| table _time eventSource eventName eventType errorCode awsRegion userIdentity.accountId
</code></pre><p><img loading=lazy src=/images/2020_04_20_4.png alt></p><hr><p><strong>Summary</strong>: In this post, we learnt how to setup up a Splunk environment on AWS for lab purposes. We used Terraform to setup the AWS environment and then manually configured Splunk to integrate the CloudTrail logs.</p><hr><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://docs.splunk.com/Documentation/Splunk/latest/Security/Secureyouradminaccount#Create_admin_credentials_after_starting_Splunk_Enterprise>https://docs.splunk.com/Documentation/Splunk/latest/Security/Secureyouradminaccount#Create_admin_credentials_after_starting_Splunk_Enterprise</a></li><li><a href=https://docs.splunk.com/Documentation/AddOns/released/AWS/Setuptheadd-on>https://docs.splunk.com/Documentation/AddOns/released/AWS/Setuptheadd-on</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://www.logsec.cloud/posts/ingest-vpc-flow-logs-to-splunk/><span class=title>« Prev</span><br><span>Ingest VPC Flow Logs with Additional Meta-Data to Splunk</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on twitter" href="https://twitter.com/intent/tweet/?text=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f&title=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk&summary=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk&source=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f&title=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on whatsapp" href="https://api.whatsapp.com/send?text=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk%20-%20https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ingest AWS CloudTrail logs to Splunk on telegram" href="https://telegram.me/share/url?text=Ingest%20AWS%20CloudTrail%20logs%20to%20Splunk&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fingest-cloudtrail-logs-to-splunk%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=harwinds/logsec data-repo-id=R_kgDOGjnARg data-category=Announcements data-category-id=DIC_kwDOGjnARs4CAWru data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-theme=dark data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.logsec.cloud>logsec</a></span>
<span>Powered:
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>