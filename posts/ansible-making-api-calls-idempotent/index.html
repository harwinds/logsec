<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ansible - Making API calls idempotent | logsec</title><meta name=keywords content><meta name=description content="This article is about the Ansible URI module. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.
We all know Ansible modules are ideompotent in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions."><meta name=author content><link rel=canonical href=https://www.logsec.cloud/posts/ansible-making-api-calls-idempotent/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Ansible - Making API calls idempotent"><meta property="og:description" content="This article is about the Ansible URI module. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.
We all know Ansible modules are ideompotent in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions."><meta property="og:type" content="article"><meta property="og:url" content="https://www.logsec.cloud/posts/ansible-making-api-calls-idempotent/"><meta property="og:image" content="https://www.logsec.cloud/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-28T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-28T00:00:00+00:00"><meta property="og:site_name" content="logsec"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.logsec.cloud/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Ansible - Making API calls idempotent"><meta name=twitter:description content="This article is about the Ansible URI module. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.
We all know Ansible modules are ideompotent in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.logsec.cloud/posts/"},{"@type":"ListItem","position":3,"name":"Ansible - Making API calls idempotent","item":"https://www.logsec.cloud/posts/ansible-making-api-calls-idempotent/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ansible - Making API calls idempotent","name":"Ansible - Making API calls idempotent","description":"This article is about the Ansible URI module. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.\nWe all know Ansible modules are ideompotent in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions.","keywords":[],"articleBody":"This article is about the Ansible URI module. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.\nWe all know Ansible modules are ideompotent in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions. However, sometimes making the tasks idempotent requires additional work, for instance, in URI modulde we have to decide when to use POST or PUT calls.\nDifference between POST and PUT? Both POST and PUT are used to send data to a server to create/update a resource. The difference between POST and PUT is that PUT requests are idempotent. That is, calling the same PUT request multiple times will always produce the same result. In contrast, calling a POST request repeatedly have side effects of creating the same resource multiple times or failing with an error message that the resource already exists.\nLet’s start with the playbook:\n--- - name: Kibana Fleet tasks hosts: localhost connection: local roles: - fleet Directory Stucture of the fleet role:\nfleet/ ├── tasks # Includes Ansible tasks using the URI module ├── policies # Fleet policies └── vars # Variables Variables main.yml in the vars directory:\n--- kibana_url: https://:5601 fleet_username: fleet_password: force_basic_auth: true validate_certs: false policies/elasticagent.json\n{ \"name\": \"elasticagent\", \"description\": \"Elastic-Agent Endpoints\", \"namespace\": \"default\", \"monitoring_enabled\": [ \"logs\", \"metrics\" ] } Below are the List Policies related tasks under the tasks directory. We are making the GET call first to list the exisitng policies, so that later we can make a decisin based on the response of GET call, if we need to create a new policy or update an existing policy. For the new policies, we have created a new variable called policies_to_create based on the template files in the directory called policies.\nLater, we ran a delta using the difference filter between the two two variables policies_to_create \u0026 policies_to_update. Result of this will the policies that we need to create.\nMore on difference filter: https://docs.ansible.com/ansible/devel/collections/ansible/builtin/difference_filter.html\n--- - name: List Policies ansible.builtin.uri: url: \"{{ kibana_url }}/api/fleet/agent_policies\" method: GET body_format: json status_code: [200] user: \"{{ fleet_username }}\" password: \"{{ fleet_password }}\" force_basic_auth: \"{{ force_basic_auth }}\" validate_certs: \"{{ validate_certs }}\" headers: kbn-xsrf: \"true\" ignore_errors: true register: list_policies_response - name: Extract all policies from the list_policies_response ansible.builtin.set_fact: policies: \"{{ policies | default({}) | combine({item.name: item.id}) }}\" policies_to_update: \"{{ policies_to_update | default([]) + [item.name] }}\" with_items: \"{{ list_policies_response | json_query('json.items') }}\" - name: Extract all policies_to_create from the folder \"policies/*.json\" ansible.builtin.set_fact: policies_to_create: \"{{ policies_to_create | default([]) + [item | basename | splitext | first] }}\" with_fileglob: \"policies/*.json\" - name: Gather all policies that need to be created ansible.builtin.set_fact: policies_to_create: \"{{ policies_to_create | difference(policies_to_update) | list }}\" when: - policies_to_update is defined - policies_to_update != [] Create or Update Policies Based on the two variables policies_to_create \u0026 policies_to_update, we group our create and update tasks into two blocks.\n--- - name: Print required variables ansible.builtin.debug: msg: - \"policies_to_create -- {{ policies_to_create | default([]) }}\" - \"policies_to_update -- {{ policies_to_update | default([]) }}\" - name: A group of tasks to be executed when policies_to_create is defined when: - policies_to_create is defined - policies_to_create != [] block: - name: Create Agent Policies ansible.builtin.uri: url: \"{{ kibana_url }}/api/fleet/agent_policies\" method: POST body_format: json body: \"{{ lookup('file', 'policies/{{ item }}.json') }}\" status_code: [200] user: \"{{ fleet_username }}\" password: \"{{ fleet_password }}\" force_basic_auth: \"{{ force_basic_auth }}\" validate_certs: \"{{ validate_certs }}\" headers: kbn-xsrf: \"true\" ignore_errors: true register: agent_policies_response with_items: \"{{ policies_to_create }}\" - name: Response ansible.builtin.debug: msg: \"{{ agent_policies_response }}\" - name: Extract the policy_ids from the agent_policies_response variable ansible.builtin.set_fact: policy_ids: \"{{ policy_ids | default({}) | combine ({item.0 : item.1}) }}\" with_together: - \"{{ agent_policies_response | json_query('results[*].json.item.name') }}\" - \"{{ agent_policies_response | json_query('results[*].json.item.id') }}\" - name: Debug ansible.builtin.debug: msg: \"POLICY IDS - {{ policy_ids }}\" - name: A group of tasks to be executed when policies_to_update is defined when: - policies_to_update is defined - policies_to_update != [] block: - name: Update Agent Policies ansible.builtin.uri: url: \"{{ kibana_url }}/api/fleet/agent_policies/{{ policies | json_query(item) }}\" method: PUT body_format: json body: \"{{ lookup('file', 'policies/{{ item }}.json') }}\" status_code: [200] user: \"{{ fleet_username }}\" password: \"{{ fleet_password }}\" force_basic_auth: \"{{ force_basic_auth }}\" validate_certs: \"{{ validate_certs }}\" headers: kbn-xsrf: \"true\" ignore_errors: true register: agent_policies_response with_items: \"{{ policies_to_update }}\" - name: Response ansible.builtin.debug: msg: \"{{ agent_policies_response }}\" - name: Extract the policy_ids from the agent_policies_response variable ansible.builtin.set_fact: policy_ids: \"{{ policy_ids | default({}) | combine ({item.0 : item.1}) }}\" with_together: - \"{{ agent_policies_response | json_query('results[*].json.item.name') }}\" - \"{{ agent_policies_response | json_query('results[*].json.item.id') }}\" - name: Debug ansible.builtin.debug: msg: \"POLICY IDS - {{ policy_ids }}\" Note: As we can see there are some repeated code between two blocks for module set_fact, I tried to move this code outside of the block to keep the code clean, but the variable value is still being updated when the tasks are being skipped.\nAnsible documentation on condtionals states “Ansible always registers something in a registered variable for every host, even on hosts where a task fails or Ansible skips a task because a condition is not met.”\nIs this the best approach to make API calls idempotent, not sure. These are several things can be improved, but for now this is good enough for our use case. One of the short-coming is if a user creates a Fleet policy through Kibana console, and we run this role again, it will fail, as it will attempt to update the existing policy, but will not find the policy in the policies directory or in the code itself.\nHope you find this post helpful.\nReferences HTTP Request Methods Kibana Fleet APIs ","wordCount":"957","inLanguage":"en","datePublished":"2023-01-28T00:00:00Z","dateModified":"2023-01-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.logsec.cloud/posts/ansible-making-api-calls-idempotent/"},"publisher":{"@type":"Organization","name":"logsec","logo":{"@type":"ImageObject","url":"https://www.logsec.cloud/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.logsec.cloud accesskey=h title="logsec (Alt + H)">logsec</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.logsec.cloud/ title=posts><span>posts</span></a></li><li><a href=https://www.logsec.cloud/pages/about title=about><span>about</span></a></li><li><a href=https://www.logsec.cloud/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.logsec.cloud>Home</a>&nbsp;»&nbsp;<a href=https://www.logsec.cloud/posts/>Posts</a></div><h1 class=post-title>Ansible - Making API calls idempotent</h1><div class=post-meta><span title='2023-01-28 00:00:00 +0000 UTC'>January 28, 2023</span>&nbsp;·&nbsp;5 min</div></header><div class=post-content><p>This article is about the Ansible <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/uri_module.html>URI module</a>. In the last couple of months, I have spent a lot of time around automation of Elasticsearch and wanted to share some useful information about how to use Ansible to interact with REST API endpoints and making them idempotent.</p><p>We all know Ansible modules are <a href=https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html#term-Idempotency>ideompotent</a> in nature which means performing an operation once is exactly the same as the result of performing it repeatedly without any intervening actions. However, sometimes making the tasks idempotent requires additional work, for instance, in URI modulde we have to decide when to use POST or PUT calls.</p><h3 id=difference-between-post-and-put>Difference between POST and PUT?<a hidden class=anchor aria-hidden=true href=#difference-between-post-and-put>#</a></h3><p>Both <code>POST</code> and <code>PUT</code> are used to send data to a server to create/update a resource. The difference between POST and PUT is that PUT requests are idempotent. That is, calling the same PUT request multiple times will always produce the same result. In contrast, calling a POST request repeatedly have side effects of creating the same resource multiple times or failing with an error message that the resource already exists.</p><p>Let&rsquo;s start with the playbook:</p><pre tabindex=0><code>---
- name: Kibana Fleet tasks
  hosts: localhost
  connection: local
  roles:
    - fleet
</code></pre><p>Directory Stucture of the <code>fleet</code> role:</p><pre tabindex=0><code>fleet/
├── tasks       # Includes Ansible tasks using the URI module
├── policies    # Fleet policies
└── vars        # Variables
</code></pre><p>Variables <code>main.yml</code> in the vars directory:</p><pre tabindex=0><code>---
kibana_url: https://&lt;KIBANA_URL&gt;:5601

fleet_username: &lt;FLEET_USERNAME&gt;
fleet_password: &lt;FLEET_PASSWORD&gt;

force_basic_auth: true
validate_certs: false
</code></pre><p>policies/elasticagent.json</p><pre tabindex=0><code>{
    &#34;name&#34;: &#34;elasticagent&#34;,
    &#34;description&#34;: &#34;Elastic-Agent Endpoints&#34;,
    &#34;namespace&#34;: &#34;default&#34;,
    &#34;monitoring_enabled&#34;: [
        &#34;logs&#34;,
        &#34;metrics&#34;
    ]
}
</code></pre><p>Below are the List Policies related tasks under the <code>tasks</code> directory. We are making the <code>GET</code> call first to list the exisitng policies, so that later we can make a decisin based on the response of GET call, if we need to create a new policy or update an existing policy. For the new policies, we have created a new variable called <code>policies_to_create</code> based on the template files in the directory called policies.</p><p>Later, we ran a delta using the <code>difference</code> filter between the two two variables <code>policies_to_create</code> & <code>policies_to_update</code>. Result of this will the policies that we need to create.</p><p>More on difference filter: <a href=https://docs.ansible.com/ansible/devel/collections/ansible/builtin/difference_filter.html>https://docs.ansible.com/ansible/devel/collections/ansible/builtin/difference_filter.html</a></p><pre tabindex=0><code>---
- name: List Policies
  ansible.builtin.uri:
    url: &#34;{{ kibana_url }}/api/fleet/agent_policies&#34;
    method: GET
    body_format: json
    status_code: [200]
    user: &#34;{{ fleet_username }}&#34;
    password: &#34;{{ fleet_password }}&#34;
    force_basic_auth: &#34;{{ force_basic_auth }}&#34;
    validate_certs: &#34;{{ validate_certs }}&#34;
    headers:
      kbn-xsrf: &#34;true&#34;
  ignore_errors: true
  register: list_policies_response

- name: Extract all policies from the list_policies_response
  ansible.builtin.set_fact:
    policies: &#34;{{ policies | default({}) | combine({item.name: item.id}) }}&#34;
    policies_to_update: &#34;{{ policies_to_update | default([]) + [item.name] }}&#34;
  with_items: &#34;{{ list_policies_response | json_query(&#39;json.items&#39;) }}&#34;

- name: Extract all policies_to_create from the folder &#34;policies/*.json&#34;
  ansible.builtin.set_fact:
    policies_to_create: &#34;{{ policies_to_create | default([]) + [item | basename | splitext | first] }}&#34;
  with_fileglob: &#34;policies/*.json&#34;

- name: Gather all policies that need to be created
  ansible.builtin.set_fact:
    policies_to_create: &#34;{{ policies_to_create | difference(policies_to_update) | list }}&#34;
  when:
    - policies_to_update is defined
    - policies_to_update != []
</code></pre><ul><li>Create or Update Policies</li></ul><p>Based on the two variables <code>policies_to_create</code> & <code>policies_to_update</code>, we group our create and update tasks into two blocks.</p><pre tabindex=0><code>---
- name: Print required variables
  ansible.builtin.debug:
    msg:
      - &#34;policies_to_create -- {{ policies_to_create | default([]) }}&#34;
      - &#34;policies_to_update -- {{ policies_to_update | default([]) }}&#34;

- name: A group of tasks to be executed when policies_to_create is defined
  when:
    - policies_to_create is defined
    - policies_to_create != []
  block:
    - name: Create Agent Policies
      ansible.builtin.uri:
        url: &#34;{{ kibana_url }}/api/fleet/agent_policies&#34;
        method: POST
        body_format: json
        body: &#34;{{ lookup(&#39;file&#39;, &#39;policies/{{ item }}.json&#39;) }}&#34;
        status_code: [200]
        user: &#34;{{ fleet_username }}&#34;
        password: &#34;{{ fleet_password }}&#34;
        force_basic_auth: &#34;{{ force_basic_auth }}&#34;
        validate_certs: &#34;{{ validate_certs }}&#34;
        headers:
          kbn-xsrf: &#34;true&#34;
      ignore_errors: true
      register: agent_policies_response
      with_items: &#34;{{ policies_to_create }}&#34;

    - name: Response
      ansible.builtin.debug:
        msg: &#34;{{ agent_policies_response }}&#34;

    - name: Extract the policy_ids from the agent_policies_response variable
      ansible.builtin.set_fact:
        policy_ids: &#34;{{ policy_ids | default({}) | combine ({item.0 : item.1}) }}&#34;
      with_together:
        - &#34;{{ agent_policies_response | json_query(&#39;results[*].json.item.name&#39;) }}&#34;
        - &#34;{{ agent_policies_response | json_query(&#39;results[*].json.item.id&#39;) }}&#34;

    - name: Debug
      ansible.builtin.debug:
        msg: &#34;POLICY IDS - {{ policy_ids }}&#34;

- name: A group of tasks to be executed when policies_to_update is defined
  when:
    - policies_to_update is defined
    - policies_to_update != []

  block:
    - name: Update Agent Policies
      ansible.builtin.uri:
        url: &#34;{{ kibana_url }}/api/fleet/agent_policies/{{ policies | json_query(item) }}&#34;
        method: PUT
        body_format: json
        body: &#34;{{ lookup(&#39;file&#39;, &#39;policies/{{ item }}.json&#39;) }}&#34;
        status_code: [200]
        user: &#34;{{ fleet_username }}&#34;
        password: &#34;{{ fleet_password }}&#34;
        force_basic_auth: &#34;{{ force_basic_auth }}&#34;
        validate_certs: &#34;{{ validate_certs }}&#34;
        headers:
          kbn-xsrf: &#34;true&#34;
      ignore_errors: true
      register: agent_policies_response
      with_items: &#34;{{ policies_to_update }}&#34;

    - name: Response
      ansible.builtin.debug:
        msg: &#34;{{ agent_policies_response }}&#34;

    - name: Extract the policy_ids from the agent_policies_response variable
      ansible.builtin.set_fact:
        policy_ids: &#34;{{ policy_ids | default({}) | combine ({item.0 : item.1}) }}&#34;
      with_together:
        - &#34;{{ agent_policies_response | json_query(&#39;results[*].json.item.name&#39;) }}&#34;
        - &#34;{{ agent_policies_response | json_query(&#39;results[*].json.item.id&#39;) }}&#34;

    - name: Debug
      ansible.builtin.debug:
        msg: &#34;POLICY IDS - {{ policy_ids }}&#34;
</code></pre><blockquote><p>Note: As we can see there are some repeated code between two blocks for module <code>set_fact</code>, I tried to move this code outside of the block to keep the code clean, but the variable value is still being updated when the tasks are being skipped.</p></blockquote><p>Ansible documentation on <a href=https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_conditionals.html>condtionals</a> states &ldquo;Ansible always registers something in a registered variable for every host, even on hosts where a task fails or Ansible skips a task because a condition is not met.&rdquo;</p><p>Is this the best approach to make API calls idempotent, not sure. These are several things can be improved, but for now this is good enough for our use case. One of the short-coming is if a user creates a Fleet policy through Kibana console, and we run this role again, it will fail, as it will attempt to update the existing policy, but will not find the policy in the policies directory or in the code itself.</p><p>Hope you find this post helpful.</p><hr><h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3><ul><li><a href=https://www.w3schools.com/tags/ref_httpmethods.asp>HTTP Request Methods</a></li><li><a href="https://petstore.swagger.io/?url=https://raw.githubusercontent.com/elastic/kibana/8.6/x-pack/plugins/fleet/common/openapi/bundled.json">Kibana Fleet APIs</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://www.logsec.cloud/posts/cross-account-access-codecommit-repo/><span class=title>Next »</span><br><span>Configure cross-account access from an EC2 Instance to an AWS CodeCommit repo using roles</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on twitter" href="https://twitter.com/intent/tweet/?text=Ansible%20-%20Making%20API%20calls%20idempotent&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f&hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f&title=Ansible%20-%20Making%20API%20calls%20idempotent&summary=Ansible%20-%20Making%20API%20calls%20idempotent&source=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f&title=Ansible%20-%20Making%20API%20calls%20idempotent"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on whatsapp" href="https://api.whatsapp.com/send?text=Ansible%20-%20Making%20API%20calls%20idempotent%20-%20https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Ansible - Making API calls idempotent on telegram" href="https://telegram.me/share/url?text=Ansible%20-%20Making%20API%20calls%20idempotent&url=https%3a%2f%2fwww.logsec.cloud%2fposts%2fansible-making-api-calls-idempotent%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=harwinds/logsec data-repo-id=R_kgDOGjnARg data-category=Announcements data-category-id=DIC_kwDOGjnARs4CAWru data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-theme=dark data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.logsec.cloud>logsec</a></span>
<span>Powered:
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>